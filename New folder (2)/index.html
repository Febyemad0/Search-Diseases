<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Clinical Search</title>
<style>
body { font-family: Arial; background:#f0f2f5; margin:0; padding:20px; }
.container { max-width:700px; margin:auto; background:#fff; padding:25px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1);}
h2 { color:#333; }
input { width:calc(100% - 20px); padding:10px; margin:8px 0; border-radius:5px; border:1px solid #ccc; font-size:16px;}
button { background:#4CAF50; color:white; padding:10px 20px; margin:10px 5px 10px 0; border:none; border-radius:5px; cursor:pointer; font-size:16px;}
button:hover { background:#45a049; }
ul { list-style:none; padding-left:0;}
li { background:#f9f9f9; margin:5px 0; padding:8px 12px; border-radius:5px; border:1px solid #ddd;}
.section { margin-bottom:30px;}
</style>
</head>
<body>

<div class="container">

<div class="section">
<h2>üîç Search Diseases (3 Symptoms)</h2>
<input id="s1" placeholder="Symptom 1">
<input id="s2" placeholder="Symptom 2">
<input id="s3" placeholder="Symptom 3">
<ul id="results"></ul>
<button onclick="prev()">Previous</button>
<button onclick="next()">Next</button>
</div>

<div class="section">
<h2>‚ûï Add Disease (Doctor)</h2>
<input id="name" placeholder="Disease name">
<input id="symptoms" placeholder="Symptoms (comma separated)">
<button onclick="add()">Add</button>
</div>

</div>

<script>
let currentPage = 1;
let lastSymptoms = [];
let totalResults = 0;
const limit = 20;

["s1","s2","s3"].forEach(i=>{
    document.getElementById(i).addEventListener("input", search)
})

function search(){
    const symptoms = ["s1","s2","s3"].map(i=>document.getElementById(i).value.trim().toLowerCase()).filter(v=>v)
    lastSymptoms = symptoms
    currentPage = 1
    fetchResults(symptoms, currentPage)
}

function fetchResults(symptoms, page){
    fetch("/search",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({symptoms, page})
    })
    .then(r=>r.json())
    .then(data=>{
        const results = (data && Array.isArray(data.results)) ? data.results : [];
        totalResults = data.total || 0;

        const ul = document.getElementById("results");
        ul.innerHTML = "";

        if(results.length > 0){
            results.forEach(d=>{
                const li = document.createElement("li");
                li.textContent = d;
                ul.appendChild(li);
            });
        } else {
            const li = document.createElement("li");
            li.textContent = "No results found";
            ul.appendChild(li);
        }
    })
    .catch(err => console.error(err));
}

function next(){
    if(currentPage*limit < totalResults){
        currentPage++
        fetchResults(lastSymptoms, currentPage)
    }
}

function prev(){
    if(currentPage > 1){
        currentPage--
        fetchResults(lastSymptoms, currentPage)
    }
}

function add(){
    const name = document.getElementById("name").value.trim();
    const symptoms = document.getElementById("symptoms").value.split(",").map(s=>s.trim().toLowerCase()).filter(s=>s);
    if(!name || symptoms.length==0){ alert("Enter name and symptoms"); return;}
    fetch("/add",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({name,symptoms})
    }).then(()=>alert("Added")).catch(err => console.error(err));
}
</script>

</body>
</html>
